[ ] NAME:Current Task List DESCRIPTION:Root task for conversation acdc6f1f-4902-488c-887a-8283adec2307
-[ ] NAME:Migração StayFocus para Supabase DESCRIPTION:Migração completa do localStorage para arquitetura dual (Supabase + FastAPI) seguindo metodologia TDD e implementação gradual por módulos
--[x] NAME:FASE 1: Configuração e Infraestrutura DESCRIPTION:Configuração inicial do projeto Supabase, dependências, variáveis de ambiente e testes de conexão básica
---[x] NAME:Criar projeto no Supabase DESCRIPTION:Acessar supabase.com, criar novo projeto na região sa-east-1, anotar URL, chave anônima e chave de serviço
---[x] NAME:Instalar dependências do Supabase DESCRIPTION:Executar npm install @supabase/supabase-js @supabase/auth-helpers-nextjs
---[x] NAME:Configurar variáveis de ambiente DESCRIPTION:Criar/atualizar .env.local com configurações do Supabase, environment e dual-track
---[x] NAME:Testar conexão básica DESCRIPTION:Criar arquivo lib/supabase-test.ts e validar conexão com Supabase
--[x] NAME:FASE 2: Arquitetura Dual-Track DESCRIPTION:Implementação da interface DataProvider, SupabaseProvider, FastAPIProvider e sistema de fallback
---[x] NAME:Criar interface DataProvider DESCRIPTION:Criar lib/dataProviders/types.ts com interface completa para autenticação, meal plans, meal records, hidratação e receitas
---[x] NAME:Implementar SupabaseProvider DESCRIPTION:Criar lib/dataProviders/supabase.ts implementando todos os métodos da interface DataProvider com Supabase Auth e Storage
---[x] NAME:Implementar FastAPIProvider (TDD) DESCRIPTION:Criar lib/dataProviders/fastapi.ts como mock server para TDD com respostas controladas, edge cases e delays realistas
---[x] NAME:Criar factory de providers DESCRIPTION:Implementar lib/dataProviders/index.ts com lógica para escolher provider baseado no ambiente
---[x] NAME:Configurar autenticação JWT DESCRIPTION:Implementar contexto de autenticação unificado, hooks para login/logout e proteção de rotas
---[x] NAME:Criar service layer abstrato DESCRIPTION:Implementar lib/services/alimentacao.ts como camada de abstração sobre os data providers
---[x] NAME:Implementar sistema de fallback DESCRIPTION:Detectar falhas de conexão, fallback automático para localStorage, queue de sincronização e indicadores visuais
--[/] NAME:FASE 3: Migração Módulo Alimentação DESCRIPTION:Implementação completa do módulo alimentação com TDD, APIs, upload de imagens e migração de dados
---[x] NAME:Aplicar schema do banco de dados DESCRIPTION:Executar schema-alimentacao.sql no Supabase para criar todas as tabelas do módulo alimentação (meal_plans, meal_records, hydration_tracking, recipes, etc.)
---[x] NAME:Refatorar arquitetura frontend com TDD DESCRIPTION:✅ CONCLUÍDO: Vitest configurado, 26 testes implementados (88% sucesso), React Query integrado, hooks customizados criados, componentes refatorados (LembreteHidratacaoV2, PlanejadorRefeicoesV2), arquitetura dual-track funcionando, sistema de migração implementado
---[x] NAME:Implementar APIs de receitas DESCRIPTION:✅ CONCLUÍDO: CRUD completo implementado com hooks customizados (useRecipes, useCreateRecipe, useUpdateRecipe, useDeleteRecipe, useToggleFavoriteRecipe), métodos no service layer com validações, implementação no SupabaseProvider e FastAPIProvider, componente GerenciadorReceitas criado, 11 testes implementados (100% sucesso)
---[/] NAME:Configurar upload de imagens DESCRIPTION:Configurar bucket no Supabase Storage, implementar upload de fotos de refeições e receitas com otimização
---[x] NAME:Criar script de migração de dados DESCRIPTION:✅ CONCLUÍDO: dataMigration.ts implementado com extração, migração e backup automático. MigracaoDados.tsx criado com interface visual completa. Sistema de limpeza pós-migração funcionando
---[x] NAME:Implementar sincronização offline/online DESCRIPTION:✅ CONCLUÍDO: Sistema completo implementado com useOnlineStatus (detecção de conexão), offlineQueue (queue de operações), syncManager (resolução de conflitos), useSyncStatus (status consolidado), SyncStatusIndicator (UI), React Query otimizado para offline, 23/31 testes passando (74% sucesso)
---[x] NAME:Testar módulo alimentação completo DESCRIPTION:Executar testes funcionais com MCP Playwright, validar CRUD, upload de imagens, sincronização e migração de dados
--[ ] NAME:FASE 4: Refatoração Demais Módulos com TDD DESCRIPTION:Aplicar metodologia TDD para refatorar todos os módulos restantes seguindo o padrão estabelecido no módulo alimentação
---[x] NAME:Refatorar módulo Hiperfocos com TDD DESCRIPTION:Aplicar TDD para hierarquia de tarefas, alternância de foco, drag-and-drop, timing de sessões conforme docs/hiperfocos-migracao.txt
----[ ] NAME:Próximos Passos - Sistema de Hiperfocos DESCRIPTION:Implementação dos próximos passos recomendados para o sistema de hiperfocos conforme documentação
-----[/] NAME:Correção dos 25 testes falhantes DESCRIPTION:Corrigir os testes que estão falhando no sistema de hiperfocos (prioridade alta)
------[x] NAME:Analisar testes falhantes DESCRIPTION:Identificar e categorizar os 31 testes que estão falhando
------[x] NAME:Corrigir testes do ConversorInteresses DESCRIPTION:Corrigir 12 falhas relacionadas a mocks do Supabase
------[ ] NAME:Corrigir testes do useOnlineStatus DESCRIPTION:Corrigir 6 falhas com detecção offline e loops infinitos
------[ ] NAME:Corrigir testes do VisualizadorTarefas DESCRIPTION:Corrigir problema com múltiplos elementos role='list'
------[ ] NAME:Corrigir testes do offlineQueue DESCRIPTION:Corrigir problemas com persistência no localStorage
------[ ] NAME:Corrigir testes do LembreteHidratacao DESCRIPTION:Corrigir 8 falhas com React Query e mocks
-----[x] NAME:Implementação das APIs do backend DESCRIPTION:Implementar APIs CRUD completas para hiperfocos e tarefas no backend (prioridade alta)
-----[x] NAME:Service Worker para cache DESCRIPTION:Implementar Service Worker para cache offline e PWA (prioridade média)
-----[ ] NAME:Monitoramento e analytics DESCRIPTION:Configurar sistema de monitoramento, métricas e analytics (prioridade baixa)
---[ ] NAME:Refatorar módulo Saúde com TDD DESCRIPTION:Implementar TDD para medicamentos, humor, lembretes críticos e dados sensíveis com validação rigorosa
---[ ] NAME:Refatorar módulo Estudos com TDD DESCRIPTION:Aplicar TDD para sistema de pomodoro, sessões de estudo, estatísticas de produtividade e integração com pomodoroStore.ts
---[ ] NAME:Refatorar módulo Sono com TDD DESCRIPTION:Implementar TDD para padrões de sono, análise de qualidade, relatórios e tendências conforme docs/sono-migracao.txt
---[ ] NAME:Refatorar módulo Lazer com TDD DESCRIPTION:Aplicar TDD para atividades de lazer, tracking de tempo livre, sugestões personalizadas e algoritmo de recomendação
---[ ] NAME:Refatorar módulo Perfil com TDD DESCRIPTION:Implementar TDD para configurações de usuário, dados pessoais, preferências e backup/restore conforme docs/perfil-migracao.txt
---[ ] NAME:Testar integração entre módulos com TDD DESCRIPTION:Executar testes end-to-end, cenários integrados, compartilhamento de dados, performance e sincronização cross-module
--[ ] NAME:FASE 5: Otimizações e Finalização DESCRIPTION:Otimizações de performance, cache Redis opcional, optimistic updates, monitoramento e limpeza final
---[ ] NAME:Otimizar performance das queries DESCRIPTION:Analisar queries lentas, implementar índices adicionais e otimizar joins complexos
---[ ] NAME:Implementar cache Redis (opcional) DESCRIPTION:Configurar Redis, cache de queries frequentes e invalidação inteligente
---[ ] NAME:Implementar optimistic updates DESCRIPTION:Updates imediatos na UI, rollback em caso de erro e feedback visual adequado
---[ ] NAME:Configurar monitoramento e logs DESCRIPTION:Implementar logs estruturados, métricas de performance e alertas de erro
---[ ] NAME:Implementar sistema de backup DESCRIPTION:Backup automático de dados, restore de dados e versionamento
---[ ] NAME:Limpeza de código legacy DESCRIPTION:Remover código do localStorage, limpeza de dependências não utilizadas e refatoração final
---[ ] NAME:Documentação final e deploy DESCRIPTION:Atualizar documentação, criar guia de deploy e manual de manutenção
-[x] NAME:Refatorar módulo Hiperfocos com TDD DESCRIPTION:Refatoração completa do módulo Hiperfocos seguindo metodologia TDD, extraindo lógica de negócio, melhorando arquitetura e adicionando testes abrangentes
--[x] NAME:Integrar services nos componentes existentes DESCRIPTION:Integrar os novos services de validação e hierarquia nos componentes do módulo Hiperfocos
--[x] NAME:Migrar componentes para useHiperfocosHierarchy DESCRIPTION:Refatorar componentes para usar o novo hook customizado em vez da lógica direta do store
--[x] NAME:Implementar validação nos formulários DESCRIPTION:Adicionar validação robusta nos formulários usando os services criados
--[x] NAME:Testes de integração componentes-services DESCRIPTION:Criar testes de integração entre componentes e services para garantir funcionamento correto
--[x] NAME:Otimizar performance dos componentes DESCRIPTION:Aplicar otimizações de performance usando as novas abstrações e memoização
-[ ] NAME:ROADMAP: Próximos Módulos StayFocus DESCRIPTION:Implementação dos próximos módulos seguindo o roadmap estabelecido nos documentos de planejamento, com base na refatoração bem-sucedida do módulo Hiperfocos
-[ ] NAME:ALTA PRIORIDADE: Módulo Sessões de Alternância DESCRIPTION:Implementar sistema completo de timer Pomodoro com controles de sessão, histórico e notificações. Prazo: 1-2 semanas. Complexidade: Média. Impacto: Alto.
-[ ] NAME:Fase 1: Análise e Planejamento do Módulo Sessões DESCRIPTION:Análise do estado atual, identificação de dependências, mapeamento de componentes existentes e planejamento detalhado das tarefas. Tempo estimado: 30 minutos.
-[ ] NAME:Análise do estado atual do módulo sessões DESCRIPTION:Usar codebase-retrieval para analisar componentes e hooks existentes do módulo sessões, verificar stores Zustand e identificar APIs já implementadas.
-[ ] NAME:Identificação de dependências DESCRIPTION:Mapear stores Zustand que precisam migrar para React Query, verificar APIs existentes em pages/api/, identificar dependências entre componentes e verificar cobertura de testes atual.
-[ ] NAME:Planejamento de tarefas detalhado DESCRIPTION:Usar ferramentas de task management para organizar: criação de hooks React Query, migração de componentes, implementação/correção de APIs, atualização de testes e validação da integração.
-[ ] NAME:Fase 2: Implementação de APIs Next.js DESCRIPTION:Implementar APIs CRUD completas para sessões seguindo o padrão estabelecido em pages/api/hiperfocos/. Inclui validação, segurança e testes. Tempo estimado: 4 horas.
-[ ] NAME:Criar schema Supabase para sessões DESCRIPTION:Implementar tabela sessoes com campos: id, user_id, hiperfoco_id, tipo (foco/pausa_curta/pausa_longa), duracao_planejada, duracao_real, status, timestamps. Incluir índices para performance e RLS.
-[ ] NAME:Implementar API pages/api/sessoes/index.ts DESCRIPTION:Criar API route seguindo padrão estabelecido com métodos GET/POST, validação Zod, sanitização XSS, logs detalhados e tratamento de erros robusto.
-[ ] NAME:Implementar API pages/api/sessoes/[id].ts DESCRIPTION:Criar API route para operações PUT/DELETE em sessão específica, com validação de user_id como UUID e segurança RLS.
-[ ] NAME:Implementar API pages/api/sessoes/ativas.ts DESCRIPTION:Criar endpoint especializado para buscar sessões em andamento, com otimizações de performance e cache adequado.
-[ ] NAME:Testes manuais das APIs DESCRIPTION:Executar testes curl para todas as operações CRUD, validar responses, testar edge cases e verificar logs de debugging.
-[ ] NAME:Fase 3: Hooks React Query DESCRIPTION:Criar hooks customizados seguindo o padrão estabelecido em app/hooks/useHiperfocos.ts. Inclui funções de API, hooks React Query e estratégias de cache. Tempo estimado: 3 horas.
-[ ] NAME:Criar tipos TypeScript para sessões DESCRIPTION:Definir interfaces Sessao, CreateSessaoData, UpdateSessaoData com todos os campos necessários e validações de tipo.
-[ ] NAME:Implementar funções de API DESCRIPTION:Criar sessoesApi com métodos getSessoes, getSessao, createSessao, updateSessao, deleteSessao seguindo padrão estabelecido.
-[ ] NAME:Criar hooks React Query DESCRIPTION:Implementar useGetSessoes, useGetSessao, useCreateSessao, useUpdateSessao, useDeleteSessao com configurações de cache e invalidação adequadas.
-[ ] NAME:Implementar hooks especializados DESCRIPTION:Criar useSessoesAtivas, useTimer, useNotificacoes para funcionalidades específicas do módulo sessões.
-[ ] NAME:Configurar estratégias de cache DESCRIPTION:Definir staleTime (2 min para dados dinâmicos), invalidação de queries relacionadas e optimistic updates para melhor UX.
-[ ] NAME:Fase 4: Migração de Componentes DESCRIPTION:Migrar componentes existentes para usar React Query, substituir stores Zustand, implementar estados de loading/erro e tratamento adequado. Tempo estimado: 6 horas.
-[ ] NAME:Criar componente TimerSessao DESCRIPTION:Implementar componente principal do timer com controles play/pause/stop, exibição do tempo restante e integração com hooks customizados.
-[ ] NAME:Criar componente ControleSessao DESCRIPTION:Implementar botões de controle da sessão com estados de loading, feedback visual e tratamento de erros adequado.
-[ ] NAME:Criar componente HistoricoSessoes DESCRIPTION:Implementar lista de sessões concluídas com paginação, filtros e exibição de estatísticas.
-[ ] NAME:Criar componente ConfiguracoesTempo DESCRIPTION:Implementar interface para personalizar durações de foco e pausa, com validação e persistência de preferências.
-[ ] NAME:Migrar stores Zustand existentes DESCRIPTION:Substituir lógica dos stores Zustand por hooks React Query, mantendo compatibilidade e removendo código legacy.
-[ ] NAME:Implementar estados de loading e erro DESCRIPTION:Adicionar indicadores visuais de loading, tratamento de erros com feedback ao usuário e fallbacks adequados.
-[ ] NAME:Fase 5: Testes e Validação DESCRIPTION:Executar testes unitários, validação manual, testes de performance e verificação de persistência de dados. Tempo estimado: 3 horas.
-[ ] NAME:Executar testes unitários DESCRIPTION:Rodar npm test com padrão de sessões, verificar cobertura mínima de 80% e corrigir falhas identificadas.
-[ ] NAME:Validação manual completa DESCRIPTION:Verificar servidor funcionando (npm run dev), APIs respondendo (testes curl), interface carregando sem erros e dados persistindo no Supabase.
-[ ] NAME:Testes de performance DESCRIPTION:Validar que operações do timer respondem em < 100ms, notificações chegam no tempo correto e interface permanece responsiva.
-[ ] NAME:Verificação de persistência DESCRIPTION:Testar que histórico de sessões persiste corretamente, configurações são mantidas e sincronização funciona adequadamente.
-[ ] NAME:Documentação do módulo DESCRIPTION:Atualizar documentação com APIs implementadas, componentes criados e guia de uso para desenvolvedores.
-[ ] NAME:ALTA PRIORIDADE: Autenticação Real DESCRIPTION:Implementar sistema completo de autenticação com Supabase Auth, RLS, rotas protegidas e gestão de perfil. Prazo: 1 semana. Complexidade: Média. Impacto: Crítico.
-[ ] NAME:Configurar Supabase Auth DESCRIPTION:Configurar autenticação no Supabase, instalar @supabase/auth-helpers-react, configurar providers e URLs de redirect.
-[ ] NAME:Implementar hook useAuth DESCRIPTION:Criar hook customizado com métodos signIn, signUp, signOut, user, userId, isAuthenticated seguindo template do guia.
-[ ] NAME:Criar componentes de autenticação DESCRIPTION:Implementar LoginForm, RegisterForm, ProfileForm com validação, feedback de erro e design consistente.
-[ ] NAME:Implementar Row Level Security (RLS) DESCRIPTION:Criar políticas RLS para todas as tabelas (hiperfocos, sessões, tarefas) garantindo isolamento de dados por usuário.
-[ ] NAME:Criar middleware de rotas protegidas DESCRIPTION:Implementar ProtectedRoute component e middleware para proteger páginas que requerem autenticação.
-[ ] NAME:Migrar user_id fixo para autenticação real DESCRIPTION:Substituir UUID fixo '550e8400-e29b-41d4-a716-446655440000' por user.id real em todos os hooks e componentes.
-[ ] NAME:Testes de segurança e isolamento DESCRIPTION:Validar que usuários só acessam seus próprios dados, testar RLS e verificar que não há vazamentos entre contas.
-[ ] NAME:MÉDIA PRIORIDADE: Módulo Estatísticas DESCRIPTION:Implementar sistema completo de estatísticas com gráficos, métricas, períodos e exportação. Prazo: 2 semanas. Complexidade: Alta. Impacto: Médio.
-[ ] NAME:Implementar APIs de agregação DESCRIPTION:Criar pages/api/estatisticas/resumo.ts com agregações de sessões por período, joins otimizados e processamento de dados para estatísticas. Tempo: 3 dias.
-[ ] NAME:Criar componentes de visualização DESCRIPTION:Implementar DashboardEstatisticas, GraficoTempo, GraficoHiperfocos, MetricasResumo com bibliotecas de gráficos e design responsivo. Tempo: 4 dias.
-[ ] NAME:Implementar sistema de exportação DESCRIPTION:Criar RelatorioDetalhado, ExportarDados com geração de CSV/PDF e download de relatórios completos. Tempo: 3 dias.
-[ ] NAME:MÉDIA PRIORIDADE: PWA Avançado DESCRIPTION:Implementar funcionalidades avançadas de PWA com instalação, sync offline, push notifications e cache inteligente. Prazo: 1-2 semanas. Complexidade: Média. Impacto: Médio.
-[ ] NAME:Implementar Service Worker DESCRIPTION:Criar service worker com cache inteligente, estratégias de cache por tipo de recurso e atualizações automáticas. Tempo: 3 dias.
-[ ] NAME:Configurar Push Notifications DESCRIPTION:Implementar sistema de notificações push para lembretes de sessões, conclusão de tarefas e marcos importantes. Tempo: 2 dias.
-[ ] NAME:Implementar Background Sync DESCRIPTION:Criar sincronização em background para operações offline, queue de ações e resolução de conflitos. Tempo: 2 dias.
-[ ] NAME:Otimizar instalação PWA DESCRIPTION:Configurar manifest.json, ícones adaptativos, splash screens e prompt de instalação personalizado. Tempo: 1 dia.
-[ ] NAME:SUPORTE: Scripts e Automações para LLMs DESCRIPTION:Implementar scripts de automação, templates e ferramentas para acelerar o desenvolvimento e facilitar o trabalho de LLMs na refatoração.
-[ ] NAME:Criar scripts de análise rápida DESCRIPTION:Implementar analisar-modulo.sh, testar-apis.sh e scripts de validação para acelerar a análise inicial de módulos.
-[ ] NAME:Implementar geradores de templates DESCRIPTION:Criar gerar-template.sh para geração automática de API routes, hooks React Query e estrutura de pastas.
-[ ] NAME:Criar scripts de teste completo DESCRIPTION:Implementar testar-modulo-completo.sh e monitorar-performance.sh para validação automática de módulos.
-[ ] NAME:Implementar utilitários de desenvolvimento DESCRIPTION:Criar limpar-cache.sh, backup-modulo.sh e comandos rápidos para facilitar o desenvolvimento.
-[ ] NAME:BAIXA PRIORIDADE: Módulos Futuros DESCRIPTION:Planejamento e implementação de funcionalidades avançadas como colaboração, integrações e IA/Machine Learning para versões futuras do StayFocus.
-[ ] NAME:Módulo Colaboração DESCRIPTION:Implementar funcionalidades de equipe: hiperfocos compartilhados, comentários em tarefas e relatórios de equipe.
-[ ] NAME:Módulo Integrações DESCRIPTION:Desenvolver integrações com calendário (Google Calendar, Outlook), notas (Notion, Obsidian) e lembretes nativos.
-[ ] NAME:Módulo IA e Machine Learning DESCRIPTION:Implementar sugestões baseadas em padrões, predições de tempo para tarefas e otimização de horários ideais para foco.